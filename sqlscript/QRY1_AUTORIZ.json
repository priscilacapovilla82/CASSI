{
	"name": "QRY1_AUTORIZ",
	"properties": {
		"folder": {
			"name": "FATOS/DIARIAS/AUTORIZACAO"
		},
		"content": {
			"query": "WITH TABTMP AS (SELECT \n                   AU.HANDLE,\n\t\t\t\t   MAX(LG.HANDLE) AS SSMAX \n                FROM PROSTG.SAM_AUTORIZ_LOGSTATUS LG \n\t\t\t\tJOIN PROSTG.SAM_AUTORIZ AU ON LG.AUTORIZACAO = AU.HANDLE\n\t\t\t\t\t\t\t\tGROUP BY AU.HANDLE\n\t\t\t\t)\n\nSELECT DISTINCT\n     AUT.HANDLE AS HD_AUTORIZACAO\n    ,AES.HANDLE AS HD_AUTORIZ_EVENTO_SOLICIT\n    ,AEG.HANDLE AS HD_AUTORIZ_EVENTO_GERADO\n    ,TGE.HANDLE AS HD_TGE \n    ,BEN.HANDLE AS HD_BENEF\n    ,ENDB.ESTADO AS HD_ESTADO_BENEF\n    ,PRE2.ESTADOPAGAMENTO AS HD_ESTADO_PREST_EXEC\n    ,PRE1.HANDLE AS HD_PREST_SOLICITANTE\n    ,PRE1.PRESTADOR AS CO_PREST_SOLICITANTE\n    ,PRE2.HANDLE AS HD_PREST_EXECUTOR\n    ,PRE2.PRESTADOR AS CO_PREST_EXECUTOR\n    ,PFO.HANDLE AS HD_PREST_FORNECEDOR \n    ,PFO.PRESTADOR AS CO_PREST_FORNECEDOR \n    ,TAU.HANDLE AS HD_TP_AUTORIZ\n    ,GR.HANDLE AS HD_GRAU\n    ,GR.GRAU AS CO_GRAU\n    ,TPT.CODIGO AS CO_TP_TRATAMENTO\n    ,OBJ.CODIGO AS CO_OBJ_TRATAMENTO\n    ,TPA.HANDLE as HD_REGIME_ATEND \n    ,FNL.HANDLE AS HD_FINALID_ATEND\n    ,CRT.HANDLE AS HD_CARAT_ATEND\n    ,RGM.HANDLE AS HD_REGIME_INT\n    ,TPA.HANDLE AS HD_TP_ATEND\n    ,TPI.HANDLE AS HD_TP_INTERN\n    ,IND.HANDLE AS HD_IND_ACIDENTE\n    ,TPC.HANDLE AS HD_TP_CONSULTA\n    ,PLA.HANDLE AS HD_PLANO\n    ,CON.HANDLE AS HD_CONTRATO\n    ,GPU.HANDLE AS HD_USUARIO\n    ,TPR.HANDLE AS HD_TIS_TAB_PRECO\n    ,TPR.CODIGO AS CO_TIS_TAB_PRECO\n    ,CBO.HANDLE AS HD_CBOS\n    ,CBO.CODIGO AS CO_CBOS\n    ,TSS.CODIGO AS CO_ST_SOLICIT\n    ,AUT.SITUACAO AS CO_SITUACAO_AUT\n    ,AES.SITUACAO AS CO_SITUACAO_AES\n    ,AEG.SITUACAO AS CO_SITUACAO_AEG\n    ,AES.OPCAOOPME AS ST_OPCAO_OPME \n    ,AUT.AUTORIZACAO AS NU_AUTORIZACAO\n    ,AUT.DATAAUTORIZACAO AS DT_AUTORIZACAO_AUT\n    ,AUT.DATASOLICITACAO AS DT_SOLICITACAO_AUT\n    ,AEG.DATAAUTORIZACAO AS DT_AUTORIZACAO_AEG\n    ,AEG.DATAATENDIMENTO AS DT_ATENDIMENTO_AEG\n    ,AES.QTDSOLICITADAORIGINAL\n    ,AEG.QTDAUTORIZADA\n    ,(AES.QTDSOLICITADAORIGINAL - AEG.QTDAUTORIZADA) AS QT_NEGADA \n    ,AES.VALORUNITARIOSOLICITADO\n    ,AES.VALORUNITARIONEGOCIADOOPME\n    ,AES.VALORUNITARIOCALCULADOOPME\n    ,AES.VALORUNITARIOAUTORIZADOOPME\n    ,AES.DATASOLICITACAO AS DT_SOLICITACAO_AES \n    ,NAU.NIVELAUTORIZACAO AS NU_NIVEL_AUTORIZACAO \n    ,AUT.ORIGEMAUTORIZACAO AS CO_ORIGEM_AUTORIZACAO \n    ,AUT.SOLICITANTENOME AS NO_PROF_SOLICITANTE \n    ,AUT.SOLICITANTECRNUM AS NU_CRM_PROF_SOLICITANTE_AUT \n    ,AUT.CONSELHOPROFSOLICITANTETISS AS PK_TD_CONSELHO_Prof_Solic \n    ,AUT.UFCONSELHOPROFSOLICITANTE AS PK_TD_CONSELHO_Uf_Prof_Solic \n    ,PES.HANDLE AS HD_PREST_SOLICITANTE_AES \n    ,PES.PRESTADOR AS CO_PREST_SOLICITANTE_AES \n    ,AUT.RADIOSOLICITACAO AS DS_ORIGEM_SOLICITACAO\n    ,AUT.INDICACAOCLINICA AS DS_INDICACAO_CLINICA\n    ,AUT.DATAVALIDADE AS DT_VALIDADE_AUT\n    ,PEX.HANDLE AS HD_PREST_EXECUTOR_AES \n    ,PEX.PRESTADOR AS CO_PREST_EXECUTOR_AES \n    ,AEG.DATAHORAGERACAO AS TS_GERACAO_AEG\n    ,AEG.DATAHORALIBERACAO AS TS_LIBERACAO_AEG\n    ,AEG.USUARIOGERACAO AS HD_USUARIO_GERACAO_AEG\n    ,TGE.COMPORTAHE AS ST_HORARIO_ESPECIAL\nFROM PROSTG.SAM_AUTORIZ AUT\nLEFT JOIN PROSTG.SAM_AUTORIZ_EVENTOSOLICIT AES ON AES.AUTORIZACAO = AUT.HANDLE\nLEFT JOIN PROSTG.SAM_AUTORIZ_EVENTOGERADO AEG ON AEG.EVENTOSOLICITADO = AES.HANDLE\nJOIN PROSTG.SAM_TIPOAUTORIZ TAU ON TAU.HANDLE = AUT.TIPOAUTORIZACAO\nLEFT JOIN PROSTG.SAM_REGIMEATENDIMENTO RA ON RA.HANDLE = AUT.REGIMEATENDIMENTO\nLEFT JOIN PROSTG.SAM_LOCALATENDIMENTO LA ON LA.HANDLE = AUT.LOCALATENDIMENTO\nLEFT JOIN PROSTG.SAM_TGE TGE ON TGE.HANDLE = ISNULL(AEG.EVENTOGERADO, AES.EVENTO)\nLEFT JOIN PROSTG.SAM_TGE_NIVELAUTORIZACAO NAU ON NAU.EVENTO = TGE.HANDLE \nLEFT JOIN PROSTG.TIS_TABELAPRECO TPR ON TPR.HANDLE = TGE.TABELADOMINIOTISS\nLEFT JOIN PROSTG.SAM_GRAU GR ON GR.HANDLE = AEG.GRAUGERADO\nLEFT JOIN PROSTG.SAM_TIPOTRATAMENTO TPT ON TPT.HANDLE = TGE.TIPOTRATAMENTO\nLEFT JOIN PROSTG.SAM_OBJTRATAMENTO OBJ ON OBJ.HANDLE = TGE.OBJETIVOTRATAMENTO\nJOIN PROSTG.SAM_BENEFICIARIO BEN ON BEN.HANDLE = AUT.BENEFICIARIO \nLEFT JOIN PROSTG.SAM_PRESTADOR PRE1 ON PRE1.HANDLE = AUT.SOLICITANTE\nLEFT JOIN PROSTG.SAM_PRESTADOR PRE2 ON PRE2.HANDLE = AUT.LOCALEXECUCAO\nLEFT JOIN PROSTG.SAM_PRESTADOR PFO  ON PFO.HANDLE  = AES.FORNECEDOR\nLEFT JOIN PROSTG.SAM_PRESTADOR PES  ON PES.HANDLE  = AES.SOLICITANTE\nLEFT JOIN PROSTG.SAM_PRESTADOR PEX  ON PEX.HANDLE  = AES.EXECUTOR\nLEFT JOIN PROSTG.TIS_CBOS CBO ON CBO.HANDLE = AUT.CBOSPROFSOLICITANTETISS\nLEFT JOIN PROSTG.Z_GRUPOUSUARIOS GPU ON GPU.HANDLE = AUT.USUARIO\nLEFT JOIN PROSTG.SAM_ENDERECO ENDB ON ENDB.HANDLE = BEN.ENDERECORESIDENCIAL\nLEFT JOIN PROSTG.SAM_FINALIDADEATENDIMENTO FNL ON FNL.HANDLE = AUT.FINALIDADEATENDIMENTO\nLEFT JOIN PROSTG.TIS_CARATERATENDIMENTO CRT ON CRT.HANDLE = AUT.CARATERATENDIMENTO\nLEFT JOIN PROSTG.TIS_REGIMEINTERNACAO RGM ON RGM.HANDLE = AUT.REGIMEINTERNACAO\nLEFT JOIN PROSTG.TIS_TIPOATENDIMENTO TPA ON TPA.HANDLE = AUT.TIPOATENDIMENTO\nLEFT JOIN PROSTG.TIS_TIPOINTERNACAO TPI ON TPI.HANDLE = AUT.TIPOINTERNACAOTISS\nLEFT JOIN PROSTG.TIS_INDICADORDEACIDENTE IND ON IND.HANDLE = AUT.INDICADORDEACIDENTE\nLEFT JOIN PROSTG.TIS_TIPOCONSULTA TPC ON TPC.HANDLE = AUT.TIPOCONSULTA\nLEFT JOIN PROSTG.SAM_CONTRATO CON ON CON.HANDLE = BEN.CONTRATO\nJOIN PROSTG.SAM_PLANO PLA ON PLA.HANDLE = CON.PLANO\nLEFT JOIN PROSTG.SAM_AUTORIZ_LOGSTATUS ALG ON ALG.AUTORIZACAO = AUT.HANDLE \n\t    JOIN TABTMP ON SSMAX = ALG.HANDLE\nLEFT JOIN PROSTG.TIS_STATUSSOLICITACAO TSS ON TSS.HANDLE = ALG.STATUS\nWHERE AUT.LOCALATENDIMENTO = 1 \nAND AES.SITUACAO <> 'C' \nAND AUT.SITUACAO NOT IN ('C','F') \nAND SUBSTRING(CAST(ISNULL(ISNULL(AEG.DATAAUTORIZACAO, AES.DATASOLICITACAO ), AUT.DATAAUTORIZACAO) AS VARCHAR),1,10) = '2022-01-01'\nAND NAU.DATAFINAL IS NULL ",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "synsqlprod",
				"poolName": "synsqlprod"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}