{
	"name": "QRY04_MA2",
	"properties": {
		"folder": {
			"name": "FATOS/MENSAIS/PROVISAO"
		},
		"content": {
			"query": "SELECT DISTINCT \n\n   'MA2' CTL_ORIGEM_DADOS,\n   SYSDATETIME() AS DT_CARGA,\n   --TO_DATE('#par_DATA_REF#','YYYY-MM-DD') AS DT_REF_CARGA,\n   CAST('2022-07-22' AS DATE) AS DT_REF_CARGA,\n   PEG.HANDLE AS HD_PEG,\n   G.HANDLE AS HD_GUIA,\n   RE.HANDLE AS HD_GUIA_EVENTOS,\n   -1 AS HD_FATURA,\n   BEN.HANDLE AS HD_BENEF_EVENTO,\n   B1.HANDLE AS HD_BENEF_TITULAR,\n   CON.HANDLE AS HD_CONTRATO,\n   TGE.HANDLE AS HD_TGE,\n   PRE.PRESTADOR AS CO_PRESTADOR,\n   PEG.TABREGIMEPGTO AS CO_REGIME_PAGAMENTO, \n   PEG.PEG AS NU_PEG,\n   G.GUIA AS NU_GUIA,\n   -1 AS NU_FATURA,\n   RP.NUMEROPROTOCOLO AS NU_PROTOCOLO,\n   RP.SITUACAO AS ST_PROTOCOLO,\n   RG.SITUACAO AS ST_GUIA_REV_PAGTO,\n\n   RE.DATAATENDIMENTO,\n   RP.DATAAVISO,\n   RP.DATAPEDIDO AS DATA_RECEB_CEPAG_PEDIDO,\n   --TO_DATE('31/12/9999','DD/MM/YYYY') AS DATACONTABIL, --Não se aplica\n   CAST('9999-12-31' AS DATE) AS DATACONTABIL,\n   RP.DATAPAGAMENTOACERTO AS DATA_PREVISTA_PAGTO_ACERTO,\n\n   RE.VALORAPRESENTADO AS VALOR_APRESENTADO,\n   RE.VALORCALCULADO AS VALOR_CALC_PAGTO,\n   RE.VALORRECURSO AS VALOR_A_PAGAR,\n   RE.VALORAPRESENTADO - (CASE WHEN RE.EHESTORNO ='S' THEN -RE.VALORRECURSO ELSE RE.VALORRECURSO END) AS VALOR_GLOSADO,\n   0 AS VALOR_PAS\n\nFROM PROSTG.SAM_REVISAOPAGTO RP\n   JOIN PROSTG.SAM_REVISAOPAGTO_GUIA RG ON RP.HANDLE = RG.REVISAOPAGTO\n   JOIN PROSTG.SAM_REVISAOPAGTO_EVENTO RE ON RE.REVISAOPAGTOGUIA = RG.HANDLE\n   LEFT JOIN PROSTG.SAM_TGE TGE ON TGE.HANDLE = RE.EVENTO\n   LEFT JOIN PROSTG.SAM_CLASSEEVENTO CL ON CL.HANDLE = TGE.CLASSEEVENTO\n   JOIN PROSTG.SAM_GUIA G ON RG.GUIA = G.HANDLE\n   JOIN PROSTG.SAM_PEG PEG ON PEG.HANDLE = G.PEG\n   LEFT JOIN PROSTG.SAM_PRESTADOR PRE ON PRE.HANDLE = PEG.RECEBEDOR\n   JOIN PROSTG.SAM_BENEFICIARIO BEN  ON BEN.HANDLE = ISNULL(G.BENEFICIARIO,PEG.BENEFICIARIO)\n   LEFT JOIN PROSTG.SAM_FAMILIA FAM ON FAM.HANDLE = BEN.FAMILIA\n   LEFT JOIN PROSTG.SAM_BENEFICIARIO B1 ON B1.HANDLE = FAM.TITULARRESPONSAVEL\n   JOIN PROSTG.SAM_CONTRATO CON ON CON.HANDLE = BEN.CONTRATO\n   JOIN PROSTG.SAM_GRUPOCONTRATO GPL ON CON.GRUPOCONTRATO = GPL.HANDLE\n\nWHERE RP.SITUACAO IN ('P','B')\n   AND RP.DATAPEDIDO IS NOT NULL\n   --AND RP.DATAPEDIDO <= LAST_DAY(TO_DATE('#par_DATA_REF#','YYYY-MM-DD'))\n   AND RP.DATAPEDIDO <= EOMONTH(CAST('2022-07-22' AS DATE))\n   AND RE.EHESTORNO = 'N'\n   AND RE.VALORRECURSO > 0\n   AND CON.HANDLE IS NOT NULL --Plano/Contrato não nulo\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "synsqlprod",
				"poolName": "synsqlprod"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}